---
title: 'Comcast''s New Network Management Technique: Protocol Agnostic'
id: '139'
author: 'Chris Benard'
tags:
    - linkedin
layout: post.html.twig
category: Personal
time: '14:12:05'
---
<p><img style="border-right-width: 0px; margin: 0px 0px 5px 5px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="comcastlogo" align="right" src="http://chrisbenard.net/wp-content/uploads/2008/10/comcastlogo2.gif" width="139" height="36" /> I got an email from Comcast titled <em>&quot;Improving Your Online Experience Through Congestion Management&quot;</em>. After my <a href="http://chrisbenard.net/2008/10/08/comcast-sucks-and-is-the-worst-company-ever/">previous</a> <a href="http://consumerist.com/5052318/comcast-merges-with-thrifty-liquor">experiences</a> I've had with Comcast lately, I thought &quot;great, now they're going to screw over my bandwidth too&quot;. Generally, I'm pretty satisfied with their Internet service, even though their TV service sucks. I actually like their <a href="http://www.comcast.net/powerboost/">Powerboost</a>, and I don't think I'm paying too much money for the service.</p>  <p>The email had no details in it whatsoever, and <a href="http://help.comcast.net/content/faq/Frequently-Asked-Questions-about-Network-Management#how" rel="nofollow">the FAQ</a> said (emphasis mine):</p>  <blockquote>   <p>[The technique] will identify which customer accounts are using the greatest amounts of bandwidth and their Internet traffic will be temporarily <strong>managed</strong> until the period of congestion passes.</p> </blockquote>  <p>The &quot;managed&quot; bit scared me a little bit. Saying you're going to &quot;manage&quot; me for downloading too much sounds a bit like you're going to send a hit man to my house to take me out. I decided to dig further and noticed they had a link to documents the filed with the <a title="Federal Communications Commission" href="http://www.fcc.gov">FCC</a> at the top right of the <a href="http://www.comcast.net/terms/network/" rel="nofollow">Comcast network management page</a>. I had to read through <a href="http://chrisbenard.net/wp-content/uploads/2008/10/comcast-new-network-management-technique.pdf">20 pages of boring crap</a>, which is probably actually necessary to explain simple concepts to the <a title="Federal Communications Commission" href="http://www.fcc.gov">FCC</a>, in order to figure out exactly what this technique employs as its counter-congestion tactics.</p>  <p><strong>I plan to explain, in simple terms, how the new management technique works. Please ask any questions in the comments section.</strong></p>  <p>The important thing to realize about the new technique versus the <a href="http://arstechnica.com/news.ars/post/20071128-eff-study-reveals-evidence-of-comcasts-bittorrent-interference.html">old technique</a> is that the new technique is protocol agnostic, meaning it doesn't discriminate against certain kinds of traffic versus other types. For example, it doesn't prioritize web surfing or VoIP calling above using <a href="http://en.wikipedia.org/wiki/BitTorrent">BitTorrent</a> to download the latest <s>blockbuster movie</s> *cough* Linux distribution release.</p>  <p><a href="http://arstechnica.com/news.ars/post/20080129-p2p-users-blast-comcast-in-fcc-proceeding.html">Users hated Comcast</a> for the previous incarnation of their network management, and the FCC forced them to stop it and come up with another protocol agnostic scheme. What they ended up with, is in my opinion, a fair process that doesn't penalize anyone unless the network is in serious danger of being degraded, and even then, doesn't actually <em>do</em> anything until it actually is degraded. I am, in a word, satisfied.</p>  <p><em>All information and pictures that follow are from Comcast's document and are probably copyrighted by Comcast, even though they were submitted to the FCC. I have a reasonable basis to believe I can reproduce this information for informative purposes.</em></p>  <p><a href="http://chrisbenard.net/wp-content/uploads/2008/10/comcastnetworkdesign.png"><img style="border-right-width: 0px; margin: 0px 0px 5px 5px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="Comcast Network Design" align="right" src="http://chrisbenard.net/wp-content/uploads/2008/10/comcastnetworkdesign-thumb.png" width="230" height="182" /></a> First, you must understand how your home cable connection reaches the Internet. Your home coax (screw on cable that connects to your modem) connects to an optical node in your neighborhood area, which then connects to a CMTS (Cable Modem Termination System) at the headend (local office), which then connects to a series of routers and finally to Comcast's Internet backbone connections.</p>  <p>Each of the CMTS boxes have a number of ports on them, with separate ports for downstream (stuff you download) and upstream (stuff you upload back to the Internet). Comcast says that there are about 275 cable modems, on average, sharing a downstream port, and about 100 sharing an upstream port. Your cable modem has what is called a &quot;bootfile&quot; which is assigned by the <a href="http://en.wikipedia.org/wiki/DOCSIS">DOCSIS</a> protocol on startup. The bootfile contains a lot of information about your cable service, perhaps most importly, how fast you can download/upload.</p>  <p>The traffic management occurs based on activity at the CMTS ports and is actually applied with a combination of flags set on your cable modem and those flags being processed on Comcast's routers.</p>  <p><a href="http://chrisbenard.net/wp-content/uploads/2008/10/comcastflowchart.png"><img style="border-right-width: 0px; margin: 0px 0px 5px 5px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="Comcast Upstream Congestion Management Decision Flowchart" align="right" src="http://chrisbenard.net/wp-content/uploads/2008/10/comcastflowchart-thumb.png" width="240" height="190" /></a> The process is really quite simple. Here's how it works:</p>  <ol>   <li>Each port (keeping in mind it is <strong><em>either</em></strong> upload or download) is monitored independently. </li>    <li>Each cable modem has a flag for its current state      <ol>       <li>PBE - Priority Best Effort. The default state. </li>        <li>BE - Best Effort. A lower priority state. PBE traffic is prioritized below BE. </li>     </ol>   </li>    <li>If a port reaches &quot;Near Congestion State&quot;, which means that it has average over a certain threshold of utilization over a 15 minute period, network management will commence.      <ol>       <li>Downstream threshold: 80% utilization </li>        <li>Upstream threshold: 70% utilization </li>     </ol>   </li>    <li>The network searches for users on that CMTS port that are in an &quot;Extended High Consumption State&quot;, which means they have averaged over a certain threshold of utilization over a 15 minute period.      <ol>       <li>The user's modem is set to BE. </li>        <li>Downstream and upstream threshold: 70% utilization </li>     </ol>   </li>    <li>The network keeps the user in &quot;Extended High Consumption State&quot; until the user's average utilization has dropped below the threshold for 15 minutes      <ol>       <li>User's modem is set back to PBE. </li>        <li>Downstream and upstream threshold: 50% utilization </li>     </ol>   </li>    <li>When in the BE state, all PBE traffic will be processed by the Comcast Internet routers before the BE traffic, regardless of the type of traffic, however the likelihood of it reaching a congested status is very low, and even in that case, the probability of dropped traffic is even lower. </li> </ol>  <p>This means, while doing my large <a href="http://chrisbenard.net/usenet">USENET</a> downloads, if the network is in danger of being congested, I'll likely be set to BE. However, Comcast has been using several trial markets with this new technique, and they have this to say:</p>  <blockquote>   <p>For example, in Colorado Springs, CO, the largest test market, on any given day in August 2008, an average of 22 users out of 6,016 total subscribers in the trial had their traffic priority status changed to BE at some point during the day.</p>    <p>...</p>    <p>NetForecast, Inc. explored the potential risk of a worst-case scenario for users whose traffic is in a BE state:&#160; the possibility of &#8220;bandwidth starvation&#8221; in the theoretical case where 100 percent of the CMTS bandwidth is taken up by PBE traffic for an extended period of time.&#160; In theory, such a condition could mean that a given user whose traffic is designated BE would be unable to effectuate an upload or download (as noted above, both are managed separately) for some period of time.&#160; However, when these management techniques were tested, first in company testbeds and then in our real-world trials conducted in the five markets, such a theoretical condition did not occur.</p> </blockquote>  <p style="text-align: center"><a href="http://chrisbenard.net/wp-content/uploads/2008/10/comcasthighlevelmanagementflows.png"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="Comcast High Level Managemetn Flows" src="http://chrisbenard.net/wp-content/uploads/2008/10/comcasthighlevelmanagementflows-thumb.png" width="240" height="188" /></a></p>  <p>I think it's a very sane system, and I hope they continue to add bandwidth so that the network doesn't get congested in the first place. However, I think this system is very fair, and a lot better than the previous one.</p>  <p></p>  <p>Below, I reproduce the original email they sent me:</p> <!--more-->  <blockquote>   <p><img border="0" alt="Comcast" src="http://media2.comcast.net/anon.comcastonline2/support/Outbound_email/welcome92308/security/security_row1_02.gif" width="331" height="39" /><img alt="" src="http://media2.comcast.net/anon.comcastonline2/support/Outbound_email/welcome92308/security/security_row1_03.gif" width="219" height="39" /></p>    <p>Dear Comcast High-Speed Internet Customer: </p>    <p>Comcast is committed to providing you with the best online experience possible.      <br />One of the ways we do that is by managing the leading fiber optic network in the nation to ensure it is fast, safe and reliable. As part of our ongoing efforts to continuously improve the quality of our service, we are switching to a new network congestion management technique by the end of the year. It is focused on managing network congestion only when and where it may occur. It will also replace the current technique and will help ensure that all of our customers receive their fair share of network resources.</p>    <p>     <br />What does this mean for you? Probably nothing. We ran five market trials of this technique over the summer and found that less than one percent of customers were affected. So, the vast majority of customers will not notice any change to their Internet experience as a result of this new technique. During the times of busiest network use (which could occur at any hour, depending on your neighborhood), those very few extraordinarily heavy users &#8211; who are doing things like conducting multiple and continuous large file transfers &#8211; may experience slightly longer response times for some online activities until the period of network congestion ends.</p>    <p>     <br />As we transition to this new technique, we have amended our Acceptable Use Policy (&quot;AUP&quot;) and posted it on the Comcast.net Web site. For links to the amended AUP, as well as answers to Frequently Asked Questions and more information about this new technique or our network management efforts in general, please visit our Network Management Policy page at: <a href="http://www.comcast.net/networkmanagement">www.comcast.net/networkmanagement</a>.</p>    <p>     <br />Thank you again for choosing Comcast as your high-speed Internet provider.</p></blockquote>